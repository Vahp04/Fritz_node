generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model departamentos {
  id         Int        @id @default(autoincrement())
  nombre     String     @db.VarChar(191)
  created_at DateTime   @default(now())
  updated_at DateTime   @default(now())
  usuarios   usuarios[]
  impresora  impresora[]
  consumible consumible[]

  @@map("departamentos")
}

model sedes {
  id         Int        @id @default(autoincrement())
  nombre     String     @db.VarChar(191)
  ubicacion  String?    @db.VarChar(191)
  created_at DateTime   @default(now())
  updated_at DateTime   @default(now())
  usuarios   usuarios[]
  impresora  impresora[]
  mikrotik   mikrotik[]
  consumible consumible[]
  servidores servidores[]
  dvr        dvr[]

  @@map("sedes")
}

model tipo_equipo {
  id            Int             @id @default(autoincrement())
  nombre        String          @db.VarChar(191)
  descripcion   String?         @db.VarChar(191)
  requiere_ip   Boolean?        @default(true)
  requiere_cereal Boolean?      @default(true)
  created_at    DateTime        @default(now())
  updated_at    DateTime        @default(now())
  stock_equipos stock_equipos[]

  @@map("tipo_equipo")
}

model stock_equipos {
  id                  Int               @id @default(autoincrement())
  tipo_equipo_id      Int
  marca               String?           @db.VarChar(191)
  modelo              String?           @db.VarChar(191)
  descripcion         String?           @db.VarChar(191)
  cantidad_total      Int
  cantidad_disponible Int
  cantidad_asignada   Int
  minimo_stock        Int?
  fecha_adquisicion   DateTime?
  valor_adquisicion   Float?
  created_at          DateTime          @default(now())
  updated_at          DateTime          @default(now())
  equipo_asignado     equipo_asignado[]
  impresoras          impresora[]       @relation("ImpresoraPrincipal") 
  impresora_toner     impresora[]       @relation("TonerInstalado")
  mikrotik            mikrotik[]        @relation("MikrotikPrincipal")
  ConsumibleEquipo    ConsumibleEquipo[]       
  tipo_equipo         tipo_equipo       @relation(fields: [tipo_equipo_id], references: [id], onDelete: NoAction)
  servidores          servidores[]      @relation("ServidoresPrincipal")
  dvr                 dvr[]             @relation("DvrPrincipal")
  telefonos            telefonos[]      @relation("TelefonoUsuarios")

  @@map("stock_equipos")
}

model usuario {
  id              Int               @id @default(autoincrement())
  name            String            @db.VarChar(191)
  email           String            @unique @db.VarChar(191)
  password        String            @db.VarChar(191)
  activo          Boolean           @default(true)
  created_at      DateTime          @default(now())
  updated_at      DateTime          @default(now())
  equipo_asignado equipo_asignado[]

  @@map("usuario")
}

model usuarios {
  id              Int               @id @default(autoincrement())
  nombre          String            @db.VarChar(191)
  apellido        String?           @db.VarChar(191)
  cargo           cargo
  correo          String?           @db.VarChar(191)
  rdpfis          String?           @db.VarChar(191)
  rdpfin          String?           @db.VarChar(191)
  descripcion     String?           @db.VarChar(191)
  sede_id         Int
  departamento_id Int
  created_at      DateTime          @default(now())
  updated_at      DateTime          @default(now())
  equipo_asignado equipo_asignado[]
  departamento    departamentos     @relation(fields: [departamento_id], references: [id], onDelete: NoAction)
  sede            sedes             @relation(fields: [sede_id], references: [id], onDelete: NoAction)
  telefonos       telefonos[]

  @@map("usuarios")
}

model equipo_asignado {
  id               Int           @id @default(autoincrement())
  usuarios_id      Int
  stock_equipos_id Int
  fecha_asignacion DateTime?
  ip_equipo        String?       @db.VarChar(191)
  cereal_equipo    String?       @db.VarChar(191)  
  fecha_devolucion DateTime?
  observaciones    String?       @db.VarChar(191)
  usuario_id       Int?
  estado           String        @default("activo") @db.VarChar(191)
  created_at       DateTime      @default(now())
  updated_at       DateTime      @default(now()) @updatedAt
  stock_equipos    stock_equipos @relation(fields: [stock_equipos_id], references: [id], onDelete: NoAction)
  usuario          usuario?      @relation(fields: [usuario_id], references: [id])
  usuarios         usuarios      @relation(fields: [usuarios_id], references: [id], onDelete: NoAction)

  @@map("equipo_asignado")
}

model impresora {
  id               Int           @id @default(autoincrement())
  stock_equipos_id Int           
  nombre           String        @db.VarChar(191)
  descripcion      String?       @db.VarChar(191)
  ip_impresora     String?       @db.VarChar(191)
  cereal_impresora String?       @db.VarChar(191)
  sede_id          Int   
  departamento_id  Int
  ubicacion        String?       @db.VarChar(191)

  toner            String?       @db.VarChar(191)
  toner_actual_id  Int?         
  fecha_instalacion_toner DateTime?
  contador_instalacion_toner Int? @default(0)
  
  contador_impresiones Int       @default(0)
  estado_impresora EstadoImpresora @default(activa)
  
  created_at       DateTime      @default(now())
  updated_at       DateTime      @default(now()) @updatedAt
  
  stock_equipos    stock_equipos @relation("ImpresoraPrincipal", fields: [stock_equipos_id], references: [id], onDelete: Cascade)
  sede             sedes         @relation(fields: [sede_id], references: [id], onDelete: Cascade)
  departamento     departamentos @relation(fields: [departamento_id], references: [id], onDelete: Cascade)
  toner_actual     stock_equipos? @relation("TonerInstalado", fields: [toner_actual_id], references: [id])

  @@map("impresora")
}

model mikrotik {
  id               Int           @id @default(autoincrement())
  stock_equipos_id Int           
  descripcion      String?       @db.VarChar(191)
  ip_mikrotik      String?       @db.VarChar(191)
  cereal_mikrotik  String?       @db.VarChar(191)
  sede_id          Int
  ubicacion        String        @db.VarChar(191)
  estado           EstadoMikrotik @default(activo) 
  created_at       DateTime      @default(now())
  updated_at       DateTime      @default(now()) @updatedAt
  stock_equipos    stock_equipos @relation("MikrotikPrincipal", fields: [stock_equipos_id], references: [id], onDelete: NoAction)
  sede             sedes         @relation(fields: [sede_id], references: [id], onDelete: NoAction)

  @@map("mikrotik")
}

model consumible {
  id               Int       @id @default(autoincrement())
  nombre           String
  sede_id          Int
  departamento_id  Int
  fecha_enviado    DateTime
  detalles         String?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt

  sede            sedes        @relation(fields: [sede_id], references: [id])
  departamento    departamentos @relation(fields: [departamento_id], references: [id])
  consumible_equipos ConsumibleEquipo[]

  @@map("consumibles")
}

model ConsumibleEquipo {
  id               Int      @id @default(autoincrement())
  consumible_id    Int
  stock_equipos_id Int
  cantidad         Int

  consumible    consumible   @relation(fields: [consumible_id], references: [id], onDelete: Cascade)
  stock_equipos stock_equipos @relation(fields: [stock_equipos_id], references: [id])

  @@unique([consumible_id, stock_equipos_id])
  @@map("consumible_equipos")
}

model servidores {
  id                Int           @id @default(autoincrement())
  stock_equipos_id  Int           
  descripcion       String?       
  ip_servidores     String?       @db.VarChar(191)
  cereal_servidores String?       @db.VarChar(191)
  sede_id           Int
  ubicacion         String        @db.VarChar(191)
  estado            EstadoServidor @default(activo) 
  created_at        DateTime      @default(now())
  updated_at        DateTime      @default(now()) @updatedAt
  stock_equipos     stock_equipos @relation("ServidoresPrincipal", fields: [stock_equipos_id], references: [id], onDelete: NoAction)
  sede              sedes         @relation(fields: [sede_id], references: [id], onDelete: NoAction)

  @@map("servidores")
}

model dvr{
  id                Int            @id @default(autoincrement())
  stock_equipos_id  Int            
  sede_id           Int             
  descripcion       String?        @db.VarChar(500)
  cantidad_cam      Int            
  ip_dvr            String?        @db.VarChar(191)
  cereal_dvr        String?        @db.VarChar(191)
  mac_dvr           String?        @db.VarChar(191)
  estado            EstadoDvr      @default(activo)
  switch            String?        @db.VarChar(191)
  ubicacion         String?        @db.VarChar(191)
  created_at        DateTime       @default(now())
  updated_at        DateTime       @default(now()) @updatedAt
  stock_equipos     stock_equipos  @relation("DvrPrincipal", fields: [stock_equipos_id], references: [id], onDelete: NoAction)
  sede              sedes          @relation(fields: [sede_id], references: [id], onDelete: NoAction)

  @@map("dvr")
  }

  model telefonos{
    id                Int             @id @default(autoincrement())
    usuarios_id       Int
    stock_equipos_id  Int
    num_telefono      String          @db.VarChar(191)
    linea_telefono    String          @db.VarChar(191)
    ip_telefono       String          @db.VarChar(191)
    mac_telefono      String?         @db.VarChar(191)
    mail_telefono     String          @db.VarChar(191)
    fecha_asignacion  DateTime?
    created_at        DateTime        @default(now())
    updated_at        DateTime        @default(now()) @updatedAt
    stock_equipos     stock_equipos   @relation("TelefonoUsuarios", fields: [stock_equipos_id], references: [id], onDelete: NoAction)
    usuarios          usuarios        @relation(fields: [usuarios_id], references: [id], onDelete: NoAction)

    @@map("telefonos")
  }

enum cargo {
  Gerente
  Jefe
  Analista
  Especialista
  Becario
  Pasante
  Coordinador
  Supervisor
}

enum EstadoMikrotik {
  activo
  inactivo
  mantenimiento
  desuso
}

enum EstadoImpresora {
  activa
  inactiva
  mantenimiento
  sin_toner
  obsoleta
}

enum EstadoServidor {
  activo
  inactivo
  mantenimiento
  desuso
}

enum EstadoDvr{
  activo
  inactivo
  mantenimiento
  desuso

}

model ContadorRegistros {
  id        Int      @id @default(autoincrement())
  tipo      String   @unique // Por ejemplo: "reporte_equipos"
  ultimoNumero Int   @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}